# OpenSearch Cluster CR (단일 노드 실험 환경용)
apiVersion: opensearch.opster.io/v1
kind: OpenSearchCluster
metadata:
  name: opensearch
  namespace: logging
spec:
  bootstrap:
    # 단일 노드 클러스터에서는 부트스트랩을 비활성화
    additionalConfig:
      discovery.type: single-node
  general:
    serviceName: opensearch
    version: 2.11.1
    httpPort: 9200
    pluginsList: []
    additionalConfig:
      # 단일 노드 모드 설정
      discovery.type: single-node
  
  # 보안 설정 (초기 관리자 비밀번호)
  security:
    config:
      adminCredentialsSecret:
        name: opensearch-admin-credentials
  
  # 대시보드 설정
  dashboards:
    enable: true
    version: 2.11.1
    replicas: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 200m
        memory: 256Mi
  
  # 노드 풀 설정 (단일 노드: master + data + ingest 통합)
  nodePools:
    - component: all-in-one
      replicas: 1
      roles:
        - cluster_manager
        - data
        - ingest
      persistence:
        emptyDir: {}
      resources:
        limits:
          cpu: 1000m
          memory: 2Gi
        requests:
          cpu: 500m
          memory: 1Gi
      jvm: -Xms1g -Xmx1g
      additionalConfig:
        discovery.type: single-node
---
# OpenSearch 관리자 자격 증명 Secret
apiVersion: v1
kind: Secret
metadata:
  name: opensearch-admin-credentials
  namespace: logging
type: Opaque
stringData:
  username: admin
  password: admin
