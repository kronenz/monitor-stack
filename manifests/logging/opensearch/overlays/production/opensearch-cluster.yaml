# OpenSearch Cluster CR (단일 노드 실험 환경용)
# opensearch-operator가 이 CR을 감지하여 OpenSearch 클러스터 생성
apiVersion: opensearch.opster.io/v1
kind: OpenSearchCluster
metadata:
  name: opensearch
  namespace: logging
spec:
  general:
    serviceName: opensearch
    version: 2.17.0
    httpPort: 9200
    
    # 보안 설정 (실험 환경: 비활성화)
    # 프로덕션에서는 반드시 활성화할 것
    security:
      tls:
        http:
          generate: false
        transport:
          generate: false
    
    # 플러그인 설정
    pluginsList: []
  
  # 대시보드 설정
  dashboards:
    enable: true
    version: 2.17.0
    replicas: 1
    
    # NodePort로 노출 (실험 환경용)
    service:
      type: NodePort
      nodePort: 30601
    
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 200m
        memory: 256Mi
  
  # 노드 풀 설정 (단일 노드: master + data + ingest 통합)
  nodePools:
    - component: all-in-one
      replicas: 1
      
      # 모든 역할 부여 (단일 노드)
      roles:
        - master
        - data
        - ingest
      
      # 스토리지 설정 (Longhorn PVC)
      persistence:
        emptyDir: {}
        # 실험 환경에서는 emptyDir 사용
        # 프로덕션에서는 아래 설정 사용:
        # pvc:
        #   storageClassName: longhorn
        #   accessModes:
        #     - ReadWriteOnce
        #   storage: 20Gi
      
      # 리소스 제한 (단일 노드 실험 환경)
      resources:
        limits:
          cpu: 1000m
          memory: 2Gi
        requests:
          cpu: 500m
          memory: 1Gi
      
      # JVM 힙 설정 (메모리의 50%)
      jvm: -Xms1g -Xmx1g
